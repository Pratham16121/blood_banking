<%= render 'shared/navbar' %>
<div class="container">
  <h1>New Blood Request</h1>
  <%= form_with  url: blood_requests_path, method: :post do |f| %>
    <%= f.fields_for :blood_request do |blood_request_form| %>
      <div class="form-group">
        <%= blood_request_form.label :recipent_id, "Recipent Email" %>
        <%= blood_request_form.text_field :recipent_id, class: "form-control", id: "user-search", list: "user-list" %>
        <datalist id="user-list"></datalist>
      </div>
      <div class="form-group">
        <%= blood_request_form.label :blood_type %>
        <%= blood_request_form.select :blood_type, ['A+', 'A-', 'B+', 'B-', 'O+', 'O-', 'AB+', 'AB-'], { include_blank: true }, class: "form-control" %>
      </div>
      <div class="form-group">
        <%= blood_request_form.label :unit %>
        <%= blood_request_form.number_field :blood_unit, class: "form-control" %>
      </div>
    <% end %>
    <%= f.submit "Create Blood Request", class: "btn btn-primary" %>
  <% end %>
</div>

<script>
  $(document).ready(function() {
    // Call API to search for users as you type
    $("#user-search").on("input", function() {
      var query = $(this).val();
      if (query.length > 0) {
        $.ajax({
          url: "/users/search",
          type: "GET",
          data: { query: query },
          success: function(data) {
            var datalist = $('#user-list');
            datalist.empty(); // remove existing options
            $.each(data, function(index, user) {
              datalist.append($('<option>').val(user.id).text(user.email));
            });
          }
        });
      } else {
        $('#user-list').empty(); // clear the datalist if the search query is empty
      }
    });
  });
</script>
